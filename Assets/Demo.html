<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glitch OS Demo</title>

<!-- JSZip & Marked for markdown rendering -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.1/marked.min.js"></script>

<style>
html,body{
  margin:0;padding:0;height:100%;
  font-family:sans-serif;overflow:hidden;
}
body{
  background:url('https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Glitch-X-OS/refs/heads/main/Assets/Backgrounds/Background2.png') center/cover no-repeat;
  display:flex;flex-direction:column;
}

/* Bottom bar */
.bottom-bar{
  height:40px;background:#111;
  display:flex;align-items:center;
  padding:0 10px;color:white;
  font-family:monospace;
  position:absolute;bottom:0;width:100%;
  z-index:100;
}
.left-button{
  width:30px;height:30px;
  background:url('https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Glitch-X-OS/refs/heads/main/Assets/Icons/Icon.png') center/cover no-repeat;
  border-radius:4px;cursor:pointer;margin-right:10px;
}
.clock{color:red;margin-left:auto;}

/* Launcher */
.menu{
  position:absolute;bottom:50px;left:10px;
  width:350px;height:70%;max-height:800px;
  background:#111;border:2px solid #555;
  border-radius:15px;display:none;flex-direction:column;
  z-index:101;overflow:hidden;
  box-shadow:0 8px 20px rgba(0,0,0,0.5);
}
.search-bar{
  width:100%;padding:10px;border:none;
  border-bottom:2px solid #555;outline:none;
  font-size:16px;background:#111;color:white;
  box-sizing:border-box;
}
.apps-list{
  flex:1;display:flex;flex-wrap:wrap;
  padding:10px;gap:10px;overflow-y:auto;
}
.app-button{
  width:70px;height:90px;background:#222;
  border-radius:8px;display:flex;flex-direction:column;
  align-items:center;justify-content:flex-start;
  cursor:pointer;color:white;font-size:12px;text-align:center;
  padding-top:5px;user-select:none;position:relative;
}
.app-button img{width:48px;height:48px;margin-bottom:4px;border-radius:8px;object-fit:cover;}
.app-button:hover{background:#333;}
.delete-btn{
  position:absolute;top:2px;right:2px;
  background:red;border:none;border-radius:50%;
  width:16px;height:16px;color:white;font-size:12px;
  cursor:pointer;display:none;
}
.app-button:hover .delete-btn{display:block;}
.plus-btn{
  width:70px;height:70px;background:#444;
  border-radius:8px;display:flex;align-items:center;
  justify-content:center;font-size:32px;cursor:not-allowed;
  color:white;position:relative;
}
.plus-btn::after{
  content:"×";position:absolute;font-size:36px;color:red;
  top:-4px;right:-4px;
}

/* README */
.readme-container{
  background:#111;color:#ddd;font-family:monospace;
  font-size:12px;padding:8px;max-height:150px;
  overflow-y:auto;border-top:1px solid #555;
}
.readme-container h1,h2,h3{color:#fff;}
.readme-container a{color:#4af;text-decoration:none;}
.readme-container a:hover{text-decoration:underline;}

/* App overlay */
.app-overlay{
  position:absolute;width:600px;height:400px;
  background:#1f1f1f;border:2px solid #555;border-radius:8px;
  box-shadow:0 8px 20px rgba(0,0,0,0.5);
  display:flex;flex-direction:column;z-index:200;overflow:hidden;
}
.app-header{
  height:32px;background:#222;display:flex;
  justify-content:space-between;align-items:center;
  padding:0 8px;cursor:move;user-select:none;
}
.app-header span{color:white;font-size:14px;font-weight:bold;}
.app-header button{
  background:#333;color:white;border:none;
  width:28px;height:28px;cursor:pointer;
  border-radius:4px;margin-left:4px;font-weight:bold;
}
.app-content{flex:1;overflow:hidden;position:relative;}
iframe{width:100%;height:100%;border:none;}
</style>
</head>
<body>

<div class="menu" id="menu">
  <input type="text" class="search-bar" id="searchBar" placeholder="Search apps...">
  <div class="apps-list" id="appsList"></div>
  <div class="readme-container" id="readme">Loading README...</div>
</div>

<div class="bottom-bar">
  <div class="left-button" id="menuButton" title="Menu"></div>
  <div class="clock" id="clock">12:00 PM</div>
</div>

<input type="file" id="appFileInput" style="display:none;">

<script>
// Clock
const clock=document.getElementById('clock');
function updateClock(){
  const now=new Date();
  const h=((now.getHours()+11)%12+1);
  const m=now.getMinutes().toString().padStart(2,'0');
  const ampm=now.getHours()>=12?'PM':'AM';
  clock.textContent=`${h}:${m} ${ampm}`;
}
setInterval(updateClock,1000);updateClock();

// Menu toggle
const menu=document.getElementById('menu');
const menuButton=document.getElementById('menuButton');
menuButton.addEventListener('click',e=>{
  e.stopPropagation();
  menu.style.display=menu.style.display==='flex'?'none':'flex';
});
document.addEventListener('click',e=>{
  if(!menu.contains(e.target)&&!menuButton.contains(e.target))menu.style.display='none';
});
menu.style.display='none';
menu.style.flexDirection='column';

// App section
const appsList=document.getElementById('appsList');

// Add button (disabled)
const plusBtn=document.createElement('div');
plusBtn.className='plus-btn';
plusBtn.textContent='+';
appsList.appendChild(plusBtn);

// README rendering
const readmeEl=document.getElementById('readme');
fetch('https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Glitch-X-OS/refs/heads/main/Assets/README.md')
.then(res=>res.text())
.then(text=>{
  readmeEl.innerHTML=marked.parse(text);
})
.catch(err=>{
  readmeEl.textContent='Failed to load README.md';
  console.error(err);
});

// Example apps (defaults)
const defaultApps=[
  {
    name:'Calculator',
    icon:'https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Glitch-X-OS/main/Assets/Icons/Calculator.png',
    url:'https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Glitch-X-OS/main/Assets/Apps/Calculator.Glitch'
  },
  {
    name:'DuckDuckGo',
    icon:'https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Glitch-X-OS/main/Assets/Icons/DuckDuckGo.png',
    url:'https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Glitch-X-OS/main/Assets/Apps/DuckDuckGo.Glitch'
  }
];

// Make app buttons
defaultApps.forEach(app=>{
  const btn=document.createElement('div');
  btn.className='app-button';
  const img=document.createElement('img');
  img.src=app.icon;btn.appendChild(img);
  const span=document.createElement('span');
  span.textContent=app.name;btn.appendChild(span);
  btn.onclick=()=>openAppOverlay(app);
  appsList.insertBefore(btn,plusBtn);
});

// Overlay logic
function openAppOverlay(app){
  const overlay=document.createElement('div');
  overlay.className='app-overlay';
  overlay.style.top='80px';overlay.style.left='80px';
  overlay.dataset.max='false';

  const header=document.createElement('div');
  header.className='app-header';
  const title=document.createElement('span');
  title.textContent=app.name;header.appendChild(title);

  const controls=document.createElement('div');
  controls.style.display='flex';controls.style.gap='4px';controls.style.marginLeft='auto';
  const btnMax=document.createElement('button');btnMax.textContent='□';
  const btnClose=document.createElement('button');btnClose.textContent='×';
  controls.appendChild(btnMax);controls.appendChild(btnClose);
  header.appendChild(controls);
  overlay.appendChild(header);

  const content=document.createElement('div');
  content.className='app-content';
  overlay.appendChild(content);
  document.body.appendChild(overlay);

  // Dragging
  let dragging=false,offsetX=0,offsetY=0;
  header.addEventListener('mousedown',e=>{
    dragging=true;offsetX=e.clientX-overlay.offsetLeft;offsetY=e.clientY-overlay.offsetTop;
  });
  document.addEventListener('mousemove',e=>{
    if(dragging && overlay.dataset.max==='false'){
      overlay.style.left=(e.clientX-offsetX)+'px';
      overlay.style.top=(e.clientY-offsetY)+'px';
    }
  });
  document.addEventListener('mouseup',()=>dragging=false);

  btnClose.onclick=()=>document.body.removeChild(overlay);
  btnMax.onclick=()=>{
    if(overlay.dataset.max==='true'){
      overlay.style.width='600px';
      overlay.style.height='400px';
      overlay.style.top='80px';
      overlay.style.left='80px';
      overlay.dataset.max='false';
    }else{
      overlay.style.width='100%';
      overlay.style.height='100%';
      overlay.style.top='0';
      overlay.style.left='0';
      overlay.dataset.max='true';
    }
  };

  // Load .Glitch (as .zip)
  fetch(app.url)
  .then(res=>res.blob())
  .then(JSZip.loadAsync)
  .then(async zip=>{
    const index=zip.file('Index.html');
    if(!index)throw new Error('No Index.html found');
    const html=await index.async('string');
    const blob=new Blob([html],{type:'text/html'});
    const blobURL=URL.createObjectURL(blob);
    const iframe=document.createElement('iframe');
    iframe.src=blobURL;
    iframe.setAttribute('sandbox','allow-scripts allow-same-origin allow-forms allow-modals allow-popups');
    content.appendChild(iframe);
  })
  .catch(e=>{
    content.innerHTML='<div style="color:white;padding:10px;">Failed to load app.</div>';
    console.error(e);
  });
}
</script>
</body>
  </html>
